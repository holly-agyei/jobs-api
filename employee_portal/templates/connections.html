{% extends "base.html" %}
{% block title %}Connections - Employee Portal{% endblock %}
{% block content %}
<div class="network-page">
    <div class="network-toolbar">
        <button class="btn network-primary-btn" type="button">Post a New Job</button>
        <div class="network-icons">
            <span class="network-icon" aria-hidden="true">üîî</span>
            <span class="network-icon" aria-hidden="true">‚úâÔ∏è</span>
            <div class="network-avatar">
                {{ current_user.username[0]|upper }}
            </div>
        </div>
    </div>

    <div class="network-hero">
        <div>
            <p class="text-muted mb-1">Experts in Field</p>
            <h1 class="h3 mb-0">Grow your network</h1>
        </div>
        <div class="network-filters">
            <div class="network-search">
                <input type="search" placeholder="Search jobs or people" aria-label="Search" />
                <span class="network-search-icon" aria-hidden="true">üîç</span>
            </div>
            <button class="network-filter-btn" type="button">
                Filter
                <span aria-hidden="true">‚öôÔ∏è</span>
            </button>
        </div>
    </div>

    <section class="network-section">
        <div class="network-card-grid">
            {% if available_users %}
                {% for user in available_users %}
                <div class="network-card">
                    <div class="network-card__avatar">
                        {% if user.profile and user.profile.photo_filename %}
                            <img src="{{ url_for('static', filename='uploads/' + user.profile.photo_filename) }}" alt="{{ user.username }} profile photo">
                        {% else %}
                            {{ user.username[0]|upper }}
                        {% endif %}
                    </div>
                    <div class="network-card__name">{{ user.username }}</div>
                    <div class="network-card__role">{{ user.profile.headline or "No headline available" }}</div>
                    <div class="network-card__company">@{{ (user.profile.summary or user.email).split('@')[0][:20] }}</div>
                    <form method="post" action="{{ url_for('connections.send_request', user_id=user.id) }}">
                        {{ form.hidden_tag() }}
                        <button class="network-card__button" type="submit">Connect</button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <div class="network-empty text-center">
                    <p>No new colleagues to connect with right now.</p>
                </div>
            {% endif %}
        </div>
    </section>

    <section class="network-status-panels">
        <div class="network-panel">
            <h2>Pending Requests</h2>
            {% if incoming_requests %}
                {% for request in incoming_requests %}
                <div class="network-panel__row">
                    <div>
                        <p class="mb-0 fw-semibold">{{ request.sender.username }}</p>
                        <small class="text-muted">Sent {{ request.created_at.strftime("%b %d, %Y") }}</small>
                    </div>
                    <div class="panel-actions">
                        <form method="post" action="{{ url_for('connections.accept_request', request_id=request.id) }}">
                            {{ form.hidden_tag() }}
                            <button class="btn btn-sm btn-dark">Accept</button>
                        </form>
                        <form method="post" action="{{ url_for('connections.decline_request', request_id=request.id) }}">
                            {{ form.hidden_tag() }}
                            <button class="btn btn-sm btn-outline-secondary">Decline</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted mb-0">No incoming requests.</p>
            {% endif %}
        </div>

        <div class="network-panel">
            <h2>Connections</h2>
            {% if connected_users %}
                <div class="network-card-grid small-grid">
                    {% for user in connected_users %}
                    <div class="network-card small-card">
                        <div class="network-card__avatar">
                            {% if user.profile and user.profile.photo_filename %}
                                <img src="{{ url_for('static', filename='uploads/' + user.profile.photo_filename) }}" alt="{{ user.username }} profile photo">
                            {% else %}
                                {{ user.username[0]|upper }}
                            {% endif %}
                        </div>
                        <div class="network-card__name">{{ user.username }}</div>
                        <div class="network-card__role">{{ user.profile.headline or "No headline yet" }}</div>
                        <form method="post" action="{{ url_for('connections.remove_connection', user_id=user.id) }}" onsubmit="return confirm('Remove this connection?');">
                            {{ form.hidden_tag() }}
                            <button class="network-card__button secondary" type="submit">Remove</button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted mb-0">No active connections yet.</p>
            {% endif %}
        </div>

        <div class="network-panel">
            <h2>Requests You Sent</h2>
            {% if outgoing_requests %}
                {% for request in outgoing_requests %}
                <div class="network-panel__row">
                    <div>
                        <p class="mb-0 fw-semibold">{{ request.receiver.username }}</p>
                        <small class="text-muted">Pending since {{ request.created_at.strftime("%b %d, %Y") }}</small>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted mb-0">No pending outgoing requests.</p>
            {% endif %}
        </div>
    </section>
</div>
{% endblock %}


